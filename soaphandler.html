<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Specl - Analyser : An Assertion Language for Service Data Object" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Specl - Analyser</title>
  </head>

  <body>
    
    <a id="btt" href="#main_content_wrap" title="Click to go to top">&nbsp;<img src="images/btt.png" /></a>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/rbrunetti/Specl-Analyser">View on GitHub</a>

          <h1 id="project_title">Specl - Analyser</h1>
          <h2 id="project_tagline">An Assertion Language for Service Data Object</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/rbrunetti/Specl-Analyser/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/rbrunetti/Specl-Analyser/tarball/master">Download this project as a tar.gz file</a>
            </section>
            
          <nav>
            <ul>
              <li><a href="index.html">Home</a></li>
              <li>Examples
                <ul>
                  <li><a href="bookstore.html">Didactic Example</a></li>
                  <li><a href="soaphandler.html">SOAP Handler</a></li>
                  <li><a href="twitterrest.html">Twitter REST</a></li>
                </ul>
              </li>
            </ul>
          </nav>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">

<h1>
<a name="specl-tutorial-soaphandler-server" class="anchor" href="#specl-tutorial-soaphandler-server"><span class="octicon octicon-link"></span></a>Specl-Tutorial-SOAPHandler-Server</h1>

<p>Specl Analyzer Tutorial - SOAP Handler, Server Side project</p>

<p>The developed web service is called <em>BookstoreWS</em>, it also use an attached SOAP Handler for use Specl as pre-condition validator.</p>

<h2>
<a name="table-of-content-2" class="anchor" href="#table-of-content-2"><span class="octicon octicon-link"></span></a>Table of Content</h2>

<ol>
<li>
<a href="#example_handler_server_setup">Setup</a>

<ol>
<li><a href="#example_handler_server_libs">Needed Libraries</a></li>
<li><a href="#example_handler_server_install">Installation</a></li>
</ol>
</li>
<li><a href="#example_handler_server_wsclient">WS</a></li>
<li><a href="#example_handler_server_handler">Server SOAP Handler</a></li>
<li><a href="#example_handler_server_handler_xml">Server SOAPHandler XML File</a></li>
<li><a href="#example_handler_server_handler_attach">Attach Handler to BookstoreWS</a></li>
<li><a href="#example_handler_server_proj_dir_struct">BookstoreWS Project Organization</a></li>
<li><a href="#example_handler_sources">Source</a></li>
</ol><p><a name="example_handler_server"></a></p>

<h2>
<a name="server-side" class="anchor" href="#server-side"><span class="octicon octicon-link"></span></a>Server Side</h2>

<p><a name="example_handler_server_setup"></a></p>

<h3>
<a name="setup-1" class="anchor" href="#setup-1"><span class="octicon octicon-link"></span></a>Setup</h3>

<p>Download the required libraries, import them in your project and start coding.<br></p>

<p><a name="example_handler_server_libs"></a></p>

<h4>
<a name="needed-libraries" class="anchor" href="#needed-libraries"><span class="octicon octicon-link"></span></a>Needed Libraries</h4>

<ul>
<li>Specl-Analyzer.jar (<a href="">download</a>)</li>
<li>Specl.jar (required by <em>Specl-Analyzer.jar</em>) (<a href="">download</a>)</li>
<li>json-simple-1.1.1.jar (required by <em>Specl-Analyzer.jar</em>) (<a href="">download</a>)</li>
</ul><p>Full Zip (<a href="">download</a>)</p>

<p><a name="example_handler_server_install"></a></p>

<h4>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h4>

<p>Simply save libraries in a known folder inside your project and import them.<br>
The procedure in Eclipse IDE is</p>

<img src="http://rbrunetti.github.io/Specl-Analyser/img/soap/00-ImportLibs.png" alt="Import Libs"><br><em>Import Libraries</em>

<p><a name="example_handler_server_ws"></a></p>

<h3>
<a name="web-service" class="anchor" href="#web-service"><span class="octicon octicon-link"></span></a>Web Service</h3>

<p>A simple WS, offering informations on books.<br>
Methods are the following, the names are self-explanatory:</p>

<ul>
<li><code>getBooksByAuthor(String)</code></li>
<li><code>getBookByIsbn(String)</code></li>
<li><code>getBooksByIsbnList(List&lt;String&gt;)</code></li>
<li><code>getAllBooksTitle()</code></li>
<li><code>getBooksNumberPerAuthor()</code></li>
<li><code>getBooksByPublisherAndYearRange()</code></li>
</ul><p><em>File: ServerInfo.java</em></p>

<div class="highlight highlight-Java"><pre><span class="kn">package</span> <span class="n">it</span><span class="o">.</span><span class="na">polimi</span><span class="o">.</span><span class="na">bookstore</span><span class="o">.</span><span class="na">ws</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">it.polimi.bookstore.ws.book.HashMapWrapper</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.jws.WebMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.jws.WebService</span><span class="o">;</span>

<span class="nd">@WebService</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ServerInfo</span> <span class="o">{</span>

    <span class="nd">@WebMethod</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getBooksByAuthor</span><span class="o">(</span><span class="n">String</span> <span class="n">author</span><span class="o">);</span>

    <span class="nd">@WebMethod</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getBookByIsbn</span><span class="o">(</span><span class="n">String</span> <span class="n">isbn</span><span class="o">);</span>

    <span class="nd">@WebMethod</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getBooksByIsbnList</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">isbnList</span><span class="o">);</span>

    <span class="nd">@WebMethod</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getAllBooksTitle</span><span class="o">();</span>

    <span class="nd">@WebMethod</span>
    <span class="kd">public</span> <span class="n">HashMapWrapper</span> <span class="nf">getBooksNumberPerAuthor</span><span class="o">();</span>

    <span class="nd">@WebMethod</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getBooksByPublisherAndYearRange</span><span class="o">(</span><span class="n">String</span> <span class="n">publisher</span><span class="o">,</span> <span class="kt">int</span> <span class="n">startYear</span><span class="o">,</span> <span class="kt">int</span> <span class="n">endYear</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>

<p><em>File: ServerInfoImpl.java</em></p>

<div class="highlight highlight-Java"><pre><span class="kn">package</span> <span class="n">it</span><span class="o">.</span><span class="na">polimi</span><span class="o">.</span><span class="na">bookstore</span><span class="o">.</span><span class="na">ws</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">it.polimi.bookstore.ws.book.Book</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">it.polimi.bookstore.ws.book.Bookstore</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">it.polimi.bookstore.ws.book.HashMapWrapper</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.jws.HandlerChain</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.jws.WebService</span><span class="o">;</span>

<span class="nd">@WebService</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerInfoImpl</span> <span class="kd">implements</span> <span class="n">ServerInfo</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Bookstore</span> <span class="n">books</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Book</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">((</span><span class="kt">double</span><span class="o">)</span><span class="mi">2000</span><span class="o">,</span> <span class="s">"Snow Crash"</span><span class="o">,</span> <span class="s">"Neal Stephenson"</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="s">"Spectra"</span><span class="o">,</span> <span class="s">"0553380958"</span><span class="o">,</span> <span class="o">(</span><span class="kt">double</span><span class="o">)</span><span class="mi">15</span><span class="o">);</span>
        <span class="n">Book</span> <span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">((</span><span class="kt">double</span><span class="o">)</span><span class="mi">2005</span><span class="o">,</span> <span class="s">"Burning Tower"</span><span class="o">,</span> <span class="s">"Larry Niven"</span><span class="o">,</span> <span class="s">"Jerry Pournelle"</span><span class="o">,</span> <span class="s">"Pocket"</span><span class="o">,</span> <span class="s">"0743416910"</span><span class="o">,</span> <span class="o">(</span><span class="kt">double</span><span class="o">)</span><span class="mi">6</span><span class="o">);</span>
        <span class="n">Book</span> <span class="n">third</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">((</span><span class="kt">double</span><span class="o">)</span><span class="mi">1995</span><span class="o">,</span> <span class="s">"Zodiac"</span><span class="o">,</span> <span class="s">"Neal Stephenson"</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="s">"Spectra"</span><span class="o">,</span> <span class="s">"0871131811"</span><span class="o">,</span> <span class="o">(</span><span class="kt">double</span><span class="o">)</span><span class="mf">7.5</span><span class="o">);</span>

        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">first</span><span class="o">);</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">second</span><span class="o">);</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">third</span><span class="o">);</span>

        <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bookstore</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getBooksByAuthor</span><span class="o">(</span><span class="n">String</span> <span class="n">author</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">books</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">setup</span><span class="o">();</span>
        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Book</span> <span class="nl">b:</span><span class="n">books</span><span class="o">.</span><span class="na">getBookstore</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getAuthor</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">author</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getCoauthor</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">b</span><span class="o">.</span><span class="na">getCoauthor</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">author</span><span class="o">)))</span> <span class="o">{</span>
                <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getBookByIsbn</span><span class="o">(</span><span class="n">String</span> <span class="n">isbn</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">books</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">setup</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Book</span> <span class="nl">b:</span><span class="n">books</span><span class="o">.</span><span class="na">getBookstore</span><span class="o">()){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getIsbn</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">isbn</span><span class="o">)){</span>
                <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="na">getTitle</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">"No Books Found"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getBooksByIsbnList</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">isbnList</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="nl">isbn:</span><span class="n">isbnList</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">book</span> <span class="o">=</span> <span class="n">getBookByIsbn</span><span class="o">(</span><span class="n">isbn</span><span class="o">);</span>
            <span class="k">if</span><span class="o">(</span><span class="n">book</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"No Books Found"</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">book</span> <span class="o">+</span> <span class="s">" with ISBN: "</span> <span class="o">+</span> <span class="n">isbn</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getAllBooksTitle</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">books</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">setup</span><span class="o">();</span>
        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Book</span> <span class="nl">b:</span><span class="n">books</span><span class="o">.</span><span class="na">getBookstore</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="c1">// Cannot return an HashMap (see http://stackoverflow.com/a/13787059)</span>
    <span class="kd">public</span> <span class="n">HashMapWrapper</span> <span class="nf">getBooksNumberPerAuthor</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">books</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">setup</span><span class="o">();</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">authors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Book</span> <span class="nl">b:</span><span class="n">books</span><span class="o">.</span><span class="na">getBookstore</span><span class="o">()){</span>
            <span class="k">if</span><span class="o">(!</span><span class="n">authors</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getAuthor</span><span class="o">())){</span>
                <span class="n">authors</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getAuthor</span><span class="o">(),</span> <span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">authors</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getAuthor</span><span class="o">(),</span> <span class="n">authors</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getAuthor</span><span class="o">())+</span><span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">if</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getCoauthor</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
                <span class="k">if</span><span class="o">(!</span><span class="n">authors</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getCoauthor</span><span class="o">())){</span>
                    <span class="n">authors</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getCoauthor</span><span class="o">(),</span> <span class="mi">1</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">authors</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getCoauthor</span><span class="o">(),</span> <span class="n">authors</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getCoauthor</span><span class="o">())+</span><span class="mi">1</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">HashMapWrapper</span><span class="o">(</span><span class="n">authors</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getBooksByPublisherAndYearRange</span><span class="o">(</span><span class="n">String</span> <span class="n">publisher</span><span class="o">,</span> <span class="kt">int</span> <span class="n">startYear</span><span class="o">,</span> <span class="kt">int</span> <span class="n">endYear</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">books</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">setup</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Book</span> <span class="nl">b:</span><span class="n">books</span><span class="o">.</span><span class="na">getBookstore</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getPublisher</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">publisher</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">b</span><span class="o">.</span><span class="na">getYear</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="n">startYear</span> <span class="o">&amp;&amp;</span> <span class="n">b</span><span class="o">.</span><span class="na">getYear</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="n">endYear</span><span class="o">){</span>
                <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>   
<span class="o">}</span>
</pre></div>

<p>Note that <code>setup()</code> method is used for generate and fill a library of class <code>Bookstore</code>, this and <code>Book</code> classes are general POJO used for this tutorial.</p>

<p><em>File: Book.java</em></p>

<div class="highlight highlight-Java"><pre><span class="kn">package</span> <span class="n">it</span><span class="o">.</span><span class="na">polimi</span><span class="o">.</span><span class="na">bookstore</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">book</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Double</span> <span class="n">year</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">author</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">coauthor</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">publisher</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">isbn</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Double</span> <span class="n">price</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="n">Double</span> <span class="n">year</span><span class="o">,</span> <span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="n">String</span> <span class="n">author</span><span class="o">,</span> <span class="n">String</span> <span class="n">coauthor</span><span class="o">,</span> <span class="n">String</span> <span class="n">publisher</span><span class="o">,</span> <span class="n">String</span> <span class="n">isbn</span><span class="o">,</span> <span class="n">Double</span> <span class="n">price</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">year</span> <span class="o">=</span> <span class="n">year</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">author</span> <span class="o">=</span> <span class="n">author</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">coauthor</span> <span class="o">=</span> <span class="n">coauthor</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">publisher</span> <span class="o">=</span> <span class="n">publisher</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">isbn</span> <span class="o">=</span> <span class="n">isbn</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Double</span> <span class="nf">getYear</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">year</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setYear</span><span class="o">(</span><span class="n">Double</span> <span class="n">year</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">year</span> <span class="o">=</span> <span class="n">year</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">title</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAuthor</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">author</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAuthor</span><span class="o">(</span><span class="n">String</span> <span class="n">author</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">author</span> <span class="o">=</span> <span class="n">author</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getCoauthor</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">coauthor</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCoauthor</span><span class="o">(</span><span class="n">String</span> <span class="n">coauthor</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">coauthor</span> <span class="o">=</span> <span class="n">coauthor</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPublisher</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">publisher</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPublisher</span><span class="o">(</span><span class="n">String</span> <span class="n">publisher</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">publisher</span> <span class="o">=</span> <span class="n">publisher</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getIsbn</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">isbn</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIsbn</span><span class="o">(</span><span class="n">String</span> <span class="n">isbn</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">isbn</span> <span class="o">=</span> <span class="n">isbn</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Double</span> <span class="nf">getPrice</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">price</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPrice</span><span class="o">(</span><span class="n">Double</span> <span class="n">price</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span>
    <span class="o">}</span>   
<span class="o">}</span>
</pre></div>

<p><em>File: Bookstore.java</em></p>

<div class="highlight highlight-Java"><pre><span class="kn">package</span> <span class="n">it</span><span class="o">.</span><span class="na">polimi</span><span class="o">.</span><span class="na">bookstore</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">book</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Bookstore</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="n">bookstore</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Bookstore</span><span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="n">bookstore</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">bookstore</span> <span class="o">=</span> <span class="n">bookstore</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="nf">getBookstore</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">bookstore</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBookstore</span><span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="n">bookstore</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">bookstore</span> <span class="o">=</span> <span class="n">bookstore</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addBook</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">bookstore</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Book</span> <span class="nf">getBook</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">bookstore</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></div>

<p>Then we declare a web service endpoint for the service which will publish outside the service for user access.<br><em>File: WsPublisher.java</em></p>

<div class="highlight highlight-Java"><pre><span class="kn">package</span> <span class="n">it</span><span class="o">.</span><span class="na">polimi</span><span class="o">.</span><span class="na">bookstore</span><span class="o">.</span><span class="na">endpoint</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">it.polimi.bookstore.ws.ServerInfoImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.ws.Endpoint</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WsPublisher</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">Endpoint</span><span class="o">.</span><span class="na">publish</span><span class="o">(</span><span class="s">"http://localhost:8888/bookstorews/server"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ServerInfoImpl</span><span class="o">());</span>

           <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"BookStore WebService is published!"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>Finally we generate necessary Java files for the web service deployment with <code>wsgen</code> command from the bin folder of the project</p>

<pre><code>$ wsgen -keep -verbose -cp . it.polimi.bookstore.ws.ServerInfoImpl
</code></pre>

<p>This will create two files for each method of the service.</p>

<p><a name="example_handler_server_handler"></a></p>

<h3>
<a name="server-soap-handler" class="anchor" href="#server-soap-handler"><span class="octicon octicon-link"></span></a>Server SOAP Handler</h3>

<p>The server side SOAP Handler we're going to build it's going to use Specl for checking constraints on the parameters passed to BookstoreService from service clients, for every incoming message.</p>

<p>We declare and initialize the analyzer with <code>SpeclAnalyzer analyzer = new SpeclAnalyzer();</code>, then we obtain the XML Document of the SOAP Message body and pass it to the analyzer that will use it as input file and parse it as an <a href="#sdo">SDO</a> (<code>analyzer.setXMLInput(soapBody.getOwnerDocument());</code>).</p>

<div class="highlight highlight-Java"><pre><span class="c1">//...</span>
<span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handleMessage</span><span class="o">(</span><span class="n">SOAPMessageContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Server : handleMessage()......"</span><span class="o">);</span>

        <span class="n">Boolean</span> <span class="n">isResponse</span> <span class="o">=</span> <span class="o">(</span><span class="n">Boolean</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">MessageContext</span><span class="o">.</span><span class="na">MESSAGE_OUTBOUND_PROPERTY</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(!</span><span class="n">isResponse</span><span class="o">)</span> <span class="o">{</span>

            <span class="n">SpeclAnalyzer</span> <span class="n">analyzer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpeclAnalyzer</span><span class="o">();</span>

            <span class="k">try</span> <span class="o">{</span>
                <span class="n">SOAPMessage</span> <span class="n">soapMsg</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>
                <span class="n">SOAPBody</span> <span class="n">soapBody</span> <span class="o">=</span> <span class="n">soapMsg</span><span class="o">.</span><span class="na">getSOAPBody</span><span class="o">();</span>

                <span class="c1">// the analyzer parse the body of the SOAP Msg to an SDO </span>
                <span class="n">analyzer</span><span class="o">.</span><span class="na">setXMLInput</span><span class="o">(</span><span class="n">soapBody</span><span class="o">.</span><span class="na">getOwnerDocument</span><span class="o">());</span>

                <span class="n">Node</span> <span class="n">requestNode</span> <span class="o">=</span> <span class="n">soapBody</span><span class="o">.</span><span class="na">getFirstChild</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">requestNode</span><span class="o">.</span><span class="na">getLocalName</span><span class="o">();</span>

<span class="c1">//...</span>
</pre></div>

<p>At this point we check <code>name</code> (corresponding to the called method) and we evaluate Specl assertions on the passed arguments (see comments), we are checking pre-conditions.</p>

<div class="highlight highlight-Java"><pre><span class="c1">//...</span>

<span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"getBooksByAuthor"</span><span class="o">))</span> <span class="o">{</span>
    <span class="c1">// we assert that the argument could not be empty</span>
    <span class="n">String</span> <span class="n">assertion</span> <span class="o">=</span> <span class="s">"let $author = /Envelope/Body/getBooksByAuthor/arg0; $author.cardinality() == 0;"</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">analyzer</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">assertion</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Author field could not be empty."</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SpeclException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// this catch errors in the assertion, but responde to client a generic message</span>
        <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Server could not respond due to validation errors in the server side SOAPHandler."</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"getBookByIsbn"</span><span class="o">))</span> <span class="o">{</span>
    <span class="c1">// assert that the isbn argument must be long 10 characters</span>
    <span class="n">String</span> <span class="n">assertion</span> <span class="o">=</span> <span class="s">"let $isbn = /Envelope/Body/getBookByIsbn/arg0; $isbn.length() == 10;"</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">analyzer</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">assertion</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Wrong ISBN format"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SpeclException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Server could not respond due to validation errors in the server side SOAPHandler."</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"getBooksByIsbnList"</span><span class="o">))</span> <span class="o">{</span>
    <span class="c1">// assert that each isbn in the list must be long 10 characters</span>
    <span class="n">String</span> <span class="n">assertion</span> <span class="o">=</span> <span class="s">"let $isbns = /Envelope/Body/getBooksByIsbnList/arg0; forall($isbn in $isbns, $isbn.length() == 10);"</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">analyzer</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">assertion</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Wrong ISBN format"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SpeclException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Server could not respond due to validation errors in the server side SOAPHandler."</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"getBooksByPublisherAndYearRange"</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">assertion</span> <span class="o">=</span> <span class="s">"let $publisher = /Envelope/Body/getBooksByPublisherAndYearRange/arg0;"</span>
                                     <span class="o">+</span> <span class="s">"let $startYear = /Envelope/Body/getBooksByPublisherAndYearRange/arg1;"</span>
                                     <span class="o">+</span> <span class="s">"let $endYear = /Envelope/Body/getBooksByPublisherAndYearRange/arg2;"</span>
                                     <span class="o">+</span> <span class="s">"$publisher.cardinality() != 0 &amp;&amp; $startYear &gt; 1900 &amp;&amp; $endYear &lt;= 2013;"</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">analyzer</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">assertion</span><span class="o">)){</span>
            <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Passed arguments are wrong (incorrect year or empty publisher)"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SpeclException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Server could not respond due to validation errors in the server side SOAPHandler."</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"getAllBooksTitle"</span><span class="o">)</span> <span class="o">||</span> <span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"getBooksNumberPerAuthor"</span><span class="o">)){</span>
    <span class="c1">// nothing to do here, no arguments</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Wrong operation."</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">//...</span>
</pre></div>

<p>Here's the complete code of the handler.<br><em>File: ValidationHandler.java</em></p>

<div class="highlight highlight-Java"><pre><span class="kn">package</span> <span class="n">it</span><span class="o">.</span><span class="na">polimi</span><span class="o">.</span><span class="na">bookstore</span><span class="o">.</span><span class="na">handler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">it.polimi.specl.SpeclAnalyzer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">it.polimi.specl.helpers.SpeclException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.namespace.QName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.soap.SOAPBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.soap.SOAPException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.soap.SOAPFault</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.soap.SOAPMessage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.handler.MessageContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.handler.soap.SOAPHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.handler.soap.SOAPMessageContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.soap.SOAPFaultException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.w3c.dom.Node</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ValidationHandler</span> <span class="kd">implements</span> <span class="n">SOAPHandler</span><span class="o">&lt;</span><span class="n">SOAPMessageContext</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handleMessage</span><span class="o">(</span><span class="n">SOAPMessageContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Server : handleMessage()......"</span><span class="o">);</span>

        <span class="n">Boolean</span> <span class="n">isResponse</span> <span class="o">=</span> <span class="o">(</span><span class="n">Boolean</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">MessageContext</span><span class="o">.</span><span class="na">MESSAGE_OUTBOUND_PROPERTY</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(!</span><span class="n">isResponse</span><span class="o">)</span> <span class="o">{</span>

            <span class="n">SpeclAnalyzer</span> <span class="n">analyzer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpeclAnalyzer</span><span class="o">();</span>

            <span class="k">try</span> <span class="o">{</span>
                <span class="n">SOAPMessage</span> <span class="n">soapMsg</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>
                <span class="n">SOAPBody</span> <span class="n">soapBody</span> <span class="o">=</span> <span class="n">soapMsg</span><span class="o">.</span><span class="na">getSOAPBody</span><span class="o">();</span>

                <span class="c1">// the analyzer parse the body of the SOAP Msg to an SDO </span>
                <span class="n">analyzer</span><span class="o">.</span><span class="na">setXMLInput</span><span class="o">(</span><span class="n">soapBody</span><span class="o">.</span><span class="na">getOwnerDocument</span><span class="o">());</span>

                <span class="n">Node</span> <span class="n">requestNode</span> <span class="o">=</span> <span class="n">soapBody</span><span class="o">.</span><span class="na">getFirstChild</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">requestNode</span><span class="o">.</span><span class="na">getLocalName</span><span class="o">();</span>

                <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"getBooksByAuthor"</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">String</span> <span class="n">assertion</span> <span class="o">=</span> <span class="s">"let $author = /Envelope/Body/getBooksByAuthor/arg0; $author.cardinality() == 0;"</span><span class="o">;</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="k">if</span><span class="o">(</span><span class="n">analyzer</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">assertion</span><span class="o">))</span> <span class="o">{</span>
                            <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Author field could not be empty."</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SpeclException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Server could not respond due to validation errors in the server side SOAPHandler."</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"getBookByIsbn"</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">String</span> <span class="n">assertion</span> <span class="o">=</span> <span class="s">"let $isbn = /Envelope/Body/getBookByIsbn/arg0; $isbn.length() == 10;"</span><span class="o">;</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="k">if</span><span class="o">(!</span><span class="n">analyzer</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">assertion</span><span class="o">))</span> <span class="o">{</span>
                            <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Wrong ISBN format"</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SpeclException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Server could not respond due to validation errors in the server side SOAPHandler."</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"getBooksByIsbnList"</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">String</span> <span class="n">assertion</span> <span class="o">=</span> <span class="s">"let $isbns = /Envelope/Body/getBooksByIsbnList/arg0; forall($isbn in $isbns, $isbn.length() == 10);"</span><span class="o">;</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="k">if</span><span class="o">(!</span><span class="n">analyzer</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">assertion</span><span class="o">))</span> <span class="o">{</span>
                            <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Wrong ISBN format"</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SpeclException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Server could not respond due to validation errors in the server side SOAPHandler."</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"getBooksByPublisherAndYearRange"</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">String</span> <span class="n">assertion</span> <span class="o">=</span> <span class="s">"let $publisher = /Envelope/Body/getBooksByPublisherAndYearRange/arg0;"</span>
                            <span class="o">+</span> <span class="s">"let $startYear = /Envelope/Body/getBooksByPublisherAndYearRange/arg1;"</span>
                            <span class="o">+</span> <span class="s">"let $endYear = /Envelope/Body/getBooksByPublisherAndYearRange/arg2;"</span>
                            <span class="o">+</span> <span class="s">"$publisher.cardinality() != 0 &amp;&amp; $startYear &gt; 1900 &amp;&amp; $endYear &lt;= 2013;"</span><span class="o">;</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="k">if</span><span class="o">(!</span><span class="n">analyzer</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">assertion</span><span class="o">)){</span>
                            <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Passed arguments are wrong (incorrect year or empty publisher)"</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SpeclException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Server could not respond due to validation errors in the server side SOAPHandler."</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"getAllBooksTitle"</span><span class="o">)</span> <span class="o">||</span> <span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"getBooksNumberPerAuthor"</span><span class="o">)){</span>
                    <span class="c1">// nothing to do here</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Wrong operation."</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="c1">// tracking</span>
                <span class="n">soapMsg</span><span class="o">.</span><span class="na">writeTo</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>

            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SOAPException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
            <span class="o">}</span>

        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handleFault</span><span class="o">(</span><span class="n">SOAPMessageContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Server : handleFault()......"</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">(</span><span class="n">MessageContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Server : close()......"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">QName</span><span class="o">&gt;</span> <span class="nf">getHeaders</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Server : getHeaders()......"</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">generateSOAPErrMessage</span><span class="o">(</span><span class="n">SOAPMessage</span> <span class="n">msg</span><span class="o">,</span> <span class="n">String</span> <span class="n">reason</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">SOAPBody</span> <span class="n">soapBody</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="na">getSOAPPart</span><span class="o">().</span><span class="na">getEnvelope</span><span class="o">().</span><span class="na">getBody</span><span class="o">();</span>
            <span class="n">SOAPFault</span> <span class="n">soapFault</span> <span class="o">=</span> <span class="n">soapBody</span><span class="o">.</span><span class="na">addFault</span><span class="o">();</span>
            <span class="n">soapFault</span><span class="o">.</span><span class="na">setFaultString</span><span class="o">(</span><span class="n">reason</span><span class="o">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">SOAPFaultException</span><span class="o">(</span><span class="n">soapFault</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SOAPException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>

<p><a name="example_handler_server_handler_xml"></a></p>

<h3>
<a name="soaphandler-xml-file" class="anchor" href="#soaphandler-xml-file"><span class="octicon octicon-link"></span></a>SOAPHandler XML File</h3>

<p>Create a SOAP handler XML file, and puts your SOAP handler declaration.</p>

<p><em>File: handler-chain.xml</em></p>

<div class="highlight highlight-XML"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="nt">&lt;javaee:handler-chains</span> 
     <span class="na">xmlns:javaee=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span> 
     <span class="na">xmlns:xsd=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;javaee:handler-chain&gt;</span>
    <span class="nt">&lt;javaee:handler&gt;</span>
      <span class="nt">&lt;javaee:handler-class&gt;</span>it.polimi.bookstore.handler.ValidationHandler<span class="nt">&lt;/javaee:handler-class&gt;</span>
    <span class="nt">&lt;/javaee:handler&gt;</span>
  <span class="nt">&lt;/javaee:handler-chain&gt;</span>
<span class="nt">&lt;/javaee:handler-chains&gt;</span>
</pre></div>

<p><a name="example_handler_server_handler_attach"></a></p>

<h4>
<a name="attach-handler-to-bookstorews" class="anchor" href="#attach-handler-to-bookstorews"><span class="octicon octicon-link"></span></a>Attach Handler to BookstoreWS</h4>

<p>To attach above SOAP handler to web service ServerInfo.java, just annotate with @HandlerChain and specify the SOAP handler file name inside.</p>

<div class="highlight highlight-Java"><pre><span class="c1">//...</span>

<span class="nd">@WebService</span>
<span class="nd">@HandlerChain</span><span class="o">(</span><span class="n">file</span> <span class="o">=</span> <span class="s">"handler-chain.xml"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerInfoImpl</span> <span class="kd">implements</span> <span class="n">ServerInfo</span> <span class="o">{</span>

<span class="c1">//...</span>
</pre></div>

<p><a name="example_handler_server_proj_dir_struct"></a></p>

<h3>
<a name="bookstorews-project-organization" class="anchor" href="#bookstorews-project-organization"><span class="octicon octicon-link"></span></a>BookstoreWS Project Organization</h3>

<p>Here's the directory structure of the project</p>

<img src="http://rbrunetti.github.io/Specl-Analyser/img/soap/01-DirStruct.png" alt="Directory Structure">

<h1>
<a name="specl-tutorial-soaphandler-client" class="anchor" href="#specl-tutorial-soaphandler-client"><span class="octicon octicon-link"></span></a>Specl-Tutorial-SOAPHandler-Client</h1>

<p>Specl Analyzer Tutorial - SOAP Handler, Client Side project</p>

<p>Now we develop a Webservice Client for accessing to the <em>BookstoreWS</em>, and attach another handler (but on client side) for use Specl as post-condition validator and for manipulate SOAP messages.</p>

<h2>
<a name="table-of-content-3" class="anchor" href="#table-of-content-3"><span class="octicon octicon-link"></span></a>Table of Content</h2>

<ol>
<li>
<a href="#example_handler_client_setup">Setup</a>

<ol>
<li><a href="#example_handler_client_libs">Needed Libraries</a></li>
<li><a href="#example_handler_client_install">Installation</a></li>
</ol>
</li>
<li><a href="#example_handler_client_wsclient">WS Client</a></li>
<li><a href="#example_handler_client_handler">Client SOAP Handler</a></li>
<li><a href="#example_handler_client_handler_xml">Client SOAPHandler XML File</a></li>
<li><a href="#example_handler_client_handler_attach">Attach Handler to BookstoreWS</a></li>
<li><a href="#example_handler_client_proj_dir_struct">BookstoreWS Client Project Organization</a></li>
<li><a href="#example_handler_sources">Source</a></li>
</ol><p><a name="example_handler_client_setup"></a></p>

<h3>
<a name="setup-2" class="anchor" href="#setup-2"><span class="octicon octicon-link"></span></a>Setup</h3>

<p>Download the required libraries, import them in your project and start coding.<br></p>

<p><a name="example_handler_client_libs"></a></p>

<h4>
<a name="needed-libraries-1" class="anchor" href="#needed-libraries-1"><span class="octicon octicon-link"></span></a>Needed Libraries</h4>

<ul>
<li>Specl-Analyzer.jar (<a href="">download</a>)</li>
<li>Specl.jar (required by <em>Specl-Analyzer.jar</em>) (<a href="">download</a>)</li>
<li>json-simple-1.1.1.jar (required by <em>Specl-Analyzer.jar</em>) (<a href="">download</a>)</li>
</ul><p>Full Zip (<a href="">download</a>)</p>

<p><a name="example_handler_client_install"></a></p>

<h4>
<a name="installation-1" class="anchor" href="#installation-1"><span class="octicon octicon-link"></span></a>Installation</h4>

<p>Simply save libraries in a known folder inside your project and import them.<br>
In Eclipse IDE right click on the project <em>Properties</em> &gt; <em>Java Build Path</em> &gt; <em>Libraries</em> &gt; <em>Add JARs...</em> and then select the libraries from your project folder.<br>
Another way is the following:</p>

<img src="http://rbrunetti.github.io/Specl-Analyser/img/soap/00-ImportLibs.png" alt="Import Libs"><br><em>Import Libraries</em>

<p><a name="example_handler_client_wsclient"></a></p>

<h3>
<a name="ws-client" class="anchor" href="#ws-client"><span class="octicon octicon-link"></span></a>WS Client</h3>

<p>We use <code>wsimport</code> command to parse the published service WSDL file (<em>http://localhost:8888/bookstorews/server?wsdl</em>) and generate all required files to access the service.</p>

<pre><code>$ wsimport -keep -verbose http://localhost:8888/bookstorews/server?wsdl
parsing WSDL...



Generating code...

it/polimi/bookstore/ws/GetAllBooksTitle.java
it/polimi/bookstore/ws/GetAllBooksTitleResponse.java
it/polimi/bookstore/ws/GetBookByIsbn.java
it/polimi/bookstore/ws/GetBookByIsbnResponse.java
it/polimi/bookstore/ws/GetBooksByAuthor.java
it/polimi/bookstore/ws/GetBooksByAuthorResponse.java
it/polimi/bookstore/ws/GetBooksByIsbnList.java
it/polimi/bookstore/ws/GetBooksByIsbnListResponse.java
it/polimi/bookstore/ws/GetBooksNumberPerAuthor.java
it/polimi/bookstore/ws/GetBooksNumberPerAuthorResponse.java
it/polimi/bookstore/ws/HashMapWrapper.java
it/polimi/bookstore/ws/ObjectFactory.java
it/polimi/bookstore/ws/ServerInfoImpl.java
it/polimi/bookstore/ws/ServerInfoImplService.java
it/polimi/bookstore/ws/package-info.java

...
</code></pre>

<p>A client class and few methods that calls the web service and prints out the results.</p>

<p><em>File: BookstoreWSClient.java</em></p>

<div class="highlight highlight-Java"><pre><span class="kn">package</span> <span class="n">it</span><span class="o">.</span><span class="na">polimi</span><span class="o">.</span><span class="na">bookstore</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">it.polimi.bookstore.ws.HashMapWrapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">it.polimi.bookstore.ws.ServerInfoImpl</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">it.polimi.bookstore.ws.ServerInfoImplService</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.ws.soap.SOAPFaultException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BookstoreWSClient</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">ServerInfoImplService</span> <span class="n">service</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">ServerInfoImpl</span> <span class="n">ws</span><span class="o">;</span>

    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"serial"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">service</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerInfoImplService</span><span class="o">();</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getServerInfoImplPort</span><span class="o">();</span>

        <span class="n">testGetBooksByAuthor</span><span class="o">(</span><span class="s">"Larry Niven"</span><span class="o">);</span>
        <span class="n">testgetBookByIsbn</span><span class="o">(</span><span class="s">"0871131811"</span><span class="o">);</span>
        <span class="n">testGetAllBooksTitle</span><span class="o">();</span>
        <span class="n">testGetBooksByIsbnList</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="o">{</span>
                <span class="n">add</span><span class="o">(</span><span class="s">"0553380981"</span><span class="o">);</span>
                <span class="n">add</span><span class="o">(</span><span class="s">"0871131811"</span><span class="o">);</span>
                <span class="n">add</span><span class="o">(</span><span class="s">"012345678"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">testGetBooksNumberPerAuthor</span><span class="o">();</span>
        <span class="n">getBooksByPublisherAndYearRange</span><span class="o">(</span><span class="s">"Spectra"</span><span class="o">,</span> <span class="mi">1900</span><span class="o">,</span> <span class="mi">2013</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">testGetBooksByAuthor</span><span class="o">(</span><span class="n">String</span> <span class="n">author</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"testGetBooksByAuthor: "</span> <span class="o">+</span> <span class="n">ws</span><span class="o">.</span><span class="na">getBooksByAuthor</span><span class="o">(</span><span class="n">author</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SOAPFaultException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"testGetBooksByAuthor: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">testgetBookByIsbn</span><span class="o">(</span><span class="n">String</span> <span class="n">isbn</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"testgetBookByIsbn: "</span> <span class="o">+</span> <span class="n">ws</span><span class="o">.</span><span class="na">getBookByIsbn</span><span class="o">(</span><span class="n">isbn</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SOAPFaultException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"testgetBookByIsbn: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">testGetAllBooksTitle</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"testGetAllBooksTitle: "</span> <span class="o">+</span> <span class="n">ws</span><span class="o">.</span><span class="na">getAllBooksTitle</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SOAPFaultException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"testGetAllBooksTitle: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">testGetBooksByIsbnList</span><span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">isbns</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"testGetBooksByIsbnList: "</span> <span class="o">+</span> <span class="n">ws</span><span class="o">.</span><span class="na">getBooksByIsbnList</span><span class="o">(</span><span class="n">isbns</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SOAPFaultException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"testGetBooksByIsbnList: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">testGetBooksNumberPerAuthor</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">HashMapWrapper</span> <span class="n">bnpa</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="na">getBooksNumberPerAuthor</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"getBooksNumberPerAuthor() - Trendy Author Books Number: "</span> <span class="o">+</span> <span class="n">bnpa</span><span class="o">.</span><span class="na">getMap</span><span class="o">().</span><span class="na">getEntry</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getValue</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">getBooksByPublisherAndYearRange</span><span class="o">(</span><span class="n">String</span> <span class="n">publisher</span><span class="o">,</span> <span class="kt">int</span> <span class="n">startY</span><span class="o">,</span> <span class="kt">int</span> <span class="n">endY</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"getBooksByPublisherAndYearRange: "</span> <span class="o">+</span> <span class="n">ws</span><span class="o">.</span><span class="na">getBooksByPublisherAndYearRange</span><span class="o">(</span><span class="n">publisher</span><span class="o">,</span> <span class="n">startY</span><span class="o">,</span> <span class="n">endY</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SOAPFaultException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"getBooksByPublisherAndYearRange: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>

</pre></div>

<p><a name="example_handler_client_handler"></a></p>

<h3>
<a name="client-soap-handler" class="anchor" href="#client-soap-handler"><span class="octicon octicon-link"></span></a>Client SOAP Handler</h3>

<p>Create a SOAP Handler on client side for extract informations from the response message and manipulate it.<br>
It intercepts the <code>getBooksNumberPerAuthorResponse</code> (that returns a Map with entries where keys are the authors name and values the number of book in the store written by that author) than with Specl we find the author with the maximum number of book and we modify the SOAP message and remove all the other entries.</p>

<p><em>File: PostValidationHandler.java</em></p>

<div class="highlight highlight-Java"><pre><span class="kn">package</span> <span class="n">it</span><span class="o">.</span><span class="na">polimi</span><span class="o">.</span><span class="na">bookstore</span><span class="o">.</span><span class="na">handler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">it.polimi.Specl.SpeclAnalyzer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">it.polimi.Specl.helpers.SpeclException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.namespace.QName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.soap.SOAPBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.soap.SOAPException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.soap.SOAPFault</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.soap.SOAPMessage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.handler.MessageContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.handler.soap.SOAPHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.handler.soap.SOAPMessageContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.soap.SOAPFaultException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.w3c.dom.Node</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostValidationHandler</span> <span class="kd">implements</span> <span class="n">SOAPHandler</span><span class="o">&lt;</span><span class="n">SOAPMessageContext</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handleMessage</span><span class="o">(</span><span class="n">SOAPMessageContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Client : handleMessage()......"</span><span class="o">);</span>

        <span class="n">Boolean</span> <span class="n">isRequest</span> <span class="o">=</span> <span class="o">(</span><span class="n">Boolean</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">MessageContext</span><span class="o">.</span><span class="na">MESSAGE_OUTBOUND_PROPERTY</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(!</span><span class="n">isRequest</span><span class="o">)</span> <span class="o">{</span>

            <span class="n">SpeclAnalyzer</span> <span class="n">analyzer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpeclAnalyzer</span><span class="o">();</span>
            <span class="n">analyzer</span><span class="o">.</span><span class="na">shutdownLogger</span><span class="o">();</span>

            <span class="k">try</span> <span class="o">{</span>
                <span class="n">SOAPMessage</span> <span class="n">soapMsg</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>
                <span class="n">SOAPBody</span> <span class="n">soapBody</span> <span class="o">=</span> <span class="n">soapMsg</span><span class="o">.</span><span class="na">getSOAPBody</span><span class="o">();</span>
                <span class="n">Node</span> <span class="n">responseNode</span> <span class="o">=</span> <span class="n">soapBody</span><span class="o">.</span><span class="na">getFirstChild</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">responseNode</span><span class="o">.</span><span class="na">getLocalName</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"getBooksNumberPerAuthorResponse"</span><span class="o">))</span> <span class="o">{</span>

                    <span class="n">analyzer</span><span class="o">.</span><span class="na">setXMLInput</span><span class="o">(</span><span class="n">soapBody</span><span class="o">.</span><span class="na">getOwnerDocument</span><span class="o">());</span>

                    <span class="n">String</span> <span class="n">assertion</span> <span class="o">=</span> 
                              <span class="s">"let $map_entries = /Envelope/Body/getBooksNumberPerAuthorResponse/return/map;"</span>
                            <span class="o">+</span> <span class="s">"let $values = $map_entries/entry/value;"</span>
                            <span class="o">+</span> <span class="s">"let $maximum = max($num in $values, $num &gt; 0);"</span>
                            <span class="o">+</span> <span class="s">"let $author = $map_entries/entry[value==$maximum]/key;"</span>
                            <span class="o">+</span> <span class="s">"1==1;"</span><span class="o">;</span> <span class="c1">// we're interested in variables</span>

                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">analyzer</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">assertion</span><span class="o">);</span>
                        <span class="n">Object</span> <span class="n">author</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="na">getVariable</span><span class="o">(</span><span class="s">"$author"</span><span class="o">);</span>

                        <span class="n">Node</span> <span class="n">map</span> <span class="o">=</span> <span class="n">soapBody</span><span class="o">.</span><span class="na">getFirstChild</span><span class="o">().</span><span class="na">getFirstChild</span><span class="o">().</span><span class="na">getFirstChild</span><span class="o">();</span>
                        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">map</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">().</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                            <span class="n">Node</span> <span class="n">child</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">().</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                            <span class="k">if</span><span class="o">(!</span><span class="n">child</span><span class="o">.</span><span class="na">getFirstChild</span><span class="o">().</span><span class="na">getTextContent</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">author</span><span class="o">)){</span>
                                <span class="n">map</span><span class="o">.</span><span class="na">removeChild</span><span class="o">(</span><span class="n">child</span><span class="o">);</span>
                                <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span><span class="o">;</span>
                            <span class="o">}</span>
                        <span class="o">}</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SpeclException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">generateSOAPErrMessage</span><span class="o">(</span><span class="n">soapMsg</span><span class="o">,</span> <span class="s">"Errors while check post-conditions"</span><span class="o">);</span>
                    <span class="o">}</span>

                <span class="o">}</span>
                <span class="c1">// tracking</span>
                <span class="n">soapMsg</span><span class="o">.</span><span class="na">writeTo</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>

            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SOAPException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
            <span class="o">}</span>

        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handleFault</span><span class="o">(</span><span class="n">SOAPMessageContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Client : handleFault()......"</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">(</span><span class="n">MessageContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Client : close()......"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">QName</span><span class="o">&gt;</span> <span class="nf">getHeaders</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Client : getHeaders()......"</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">generateSOAPErrMessage</span><span class="o">(</span><span class="n">SOAPMessage</span> <span class="n">msg</span><span class="o">,</span> <span class="n">String</span> <span class="n">reason</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">SOAPBody</span> <span class="n">soapBody</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="na">getSOAPPart</span><span class="o">().</span><span class="na">getEnvelope</span><span class="o">().</span><span class="na">getBody</span><span class="o">();</span>
            <span class="n">SOAPFault</span> <span class="n">soapFault</span> <span class="o">=</span> <span class="n">soapBody</span><span class="o">.</span><span class="na">addFault</span><span class="o">();</span>
            <span class="n">soapFault</span><span class="o">.</span><span class="na">setFaultString</span><span class="o">(</span><span class="n">reason</span><span class="o">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">SOAPFaultException</span><span class="o">(</span><span class="n">soapFault</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SOAPException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>

<p><a name="example_handler_client_handler_xml"></a></p>

<h3>
<a name="client-soaphandler-xml-file" class="anchor" href="#client-soaphandler-xml-file"><span class="octicon octicon-link"></span></a>Client SOAPHandler XML File</h3>

<p>Create a SOAP handler XML file, and puts your SOAP handler declaration.</p>

<p><em>File: handler-chain.xml</em></p>

<div class="highlight highlight-XML"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="nt">&lt;javaee:handler-chains</span> 
     <span class="na">xmlns:javaee=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span> 
     <span class="na">xmlns:xsd=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;javaee:handler-chain&gt;</span>
    <span class="nt">&lt;javaee:handler&gt;</span>
      <span class="nt">&lt;javaee:handler-class&gt;</span>it.polimi.bookstore.handler.PostValidationHandler<span class="nt">&lt;/javaee:handler-class&gt;</span>
    <span class="nt">&lt;/javaee:handler&gt;</span>
  <span class="nt">&lt;/javaee:handler-chain&gt;</span>
<span class="nt">&lt;/javaee:handler-chains&gt;</span>
</pre></div>

<p><a name="example_handler_client_handler_attach"></a></p>

<h4>
<a name="attach-handler-to-bookstorews-1" class="anchor" href="#attach-handler-to-bookstorews-1"><span class="octicon octicon-link"></span></a>Attach Handler to BookstoreWS</h4>

<p>To attach above SOAP handler to web service ServerInfo.java, just annotate with @HandlerChain and specify the SOAP handler file name inside.</p>

<div class="highlight highlight-Java"><pre><span class="c1">//...</span>

<span class="nd">@WebServiceClient</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ServerInfoImplService"</span><span class="o">,</span> <span class="n">targetNamespace</span> <span class="o">=</span> <span class="s">"http://ws.bookstore.polimi.it/"</span><span class="o">,</span> <span class="n">wsdlLocation</span> <span class="o">=</span> <span class="s">"http://localhost:8888/bookstorews/server?wsdl"</span><span class="o">)</span>
<span class="nd">@HandlerChain</span><span class="o">(</span><span class="n">file</span> <span class="o">=</span> <span class="s">"handler-chain.xml"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerInfoImplService</span>
    <span class="kd">extends</span> <span class="n">Service</span>
<span class="o">{</span>


<span class="c1">//...</span>
</pre></div>

<p><a name="example_handler_client_proj_dir_struct"></a></p>

<h3>
<a name="bookstorews-client-project-organization" class="anchor" href="#bookstorews-client-project-organization"><span class="octicon octicon-link"></span></a>BookstoreWS Client Project Organization</h3>

<p>Here's the directory structure of the project</p>
<img src="http://rbrunetti.github.io/Specl-Analyser/img/soap/02-ClientDirStruct.png" alt="Client Directory Structure">

<p><a name="example_handler_sources"></a></p>

<h3>
<a name="project-sources" class="anchor" href="#project-sources"><span class="octicon octicon-link"></span></a>Project Sources</h3>

<p>Project sources are available on GitHub at <a href="https://github.com/rbrunetti/Specl-Tutorial-SOAPHandler-Client">Specl-Tutorial-SOAPHandler-Client</a>.<br>
Server project (on which this repository is based) is at <a href="https://github.com/rbrunetti/Specl-Tutorial-SOAPHandlerWS">Specl-Tutorial-SOAPHandlerWS</a>.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Specl - Analyser maintained by <a href="https://github.com/rbrunetti">rbrunetti</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
